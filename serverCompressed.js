var express=require("express"),app=express(),session=require("express-session");path=require("path");var request=require("request"),mysql=require("mysql"),connection=mysql.createConnection({host:"localhost",port:"8889",user:"root",password:"root",database:"mowe"});connection.connect(function(e){e?console.log("Error connecting database ... nn"):console.log("Database is connected ... nn")}),app.use(session({secret:"2C44-4D44-WppQ38S",resave:!0,saveUninitialized:!0}));var auth=function(e,s,n){return e.session&&""!=e.session.user&&e.session.admin?n():s.sendFile(__dirname+"/notAuth.html")};app.get("/login",function(o,r){if(o.query.username&&o.query.password){if(""!=o.query.username&&""!=o.query.password){var e=o.query.username,i=o.query.password;connection.query("SELECT * FROM User WHERE Name = ?",[e],function(e,s,n){e?r.send({code:400,failed:"error ocurred"}):0<s.length?s[0].Passwort==i?(o.session.user=o.query.username,o.session.admin=!0,r.sendFile(__dirname+"/logedin.html")):r.send({code:204,success:"Name and password does not match"}):r.send({code:204,success:"Name does not exits"})})}}else r.sendFile(__dirname+"/login.html")}),app.get("/logout",function(e,s){e.session.destroy(),s.send("logout success!")}),app.get("/index",auth,function(e,s){s.sendFile(__dirname+"/index.html")}),app.get("/main.js",function(e,s){s.sendFile(__dirname+"/main.js")}),app.get("/witz.json",function(e,s){s.sendFile(__dirname+"/witz.json")}),app.listen(3e3),app.use(express.static("public")),console.log("app running at http://localhost:3000");